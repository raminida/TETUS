<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌååÌä∏ÎÑà Ï†ÑÏ†Å</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Poppins:wght@600;700&family=Roboto+Condensed:wght@400;700&display=stylesheet" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            /* US Open Dark Theme (Blue) */
            --bg-color: #121212;
            --surface-color: #1E1E1E;
            --primary-color: #3399FF; /* Brighter Blue for Dark Mode */
            --primary-variant-color: #66B2FF;
            --secondary-color: #FFFFFF;
            --text-color: #E0E0E0;
            --text-secondary-color: #A0A0A0;
            --accent-gold: #FFC107; /* Tennis ball yellow */
            --border-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 20px;
            --radius: 8px;
        }
        html[data-theme="light"] {
            /* US Open Light Theme (Blue) */
            --bg-color: #F0F4F8;
            --surface-color: #FFFFFF;
            --primary-color: #0055A5; /* Official US Open Blue */
            --primary-variant-color: #007BFF;
            --text-color: #1F2937;
            --text-secondary-color: #6B7280;
            --border-color: #E5E7EB;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: 'Roboto Condensed', 'Noto Sans KR', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: var(--spacing-md);
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 1700px;
            margin: 0 auto;
        }
        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.8rem;
            font-weight: 900;
            text-align: center;
            color: var(--secondary-color);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-variant-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            padding-top: var(--spacing-lg);
            margin-bottom: 2rem;
            letter-spacing: -2px;
            text-shadow: 2px 2px 10px var(--shadow-color);
        }
        .section {
            background: var(--surface-color);
            padding: var(--spacing-lg);
            border-radius: var(--radius);
            box-shadow: 0 10px 30px var(--shadow-color);
            margin-bottom: 2.5rem;
            border: 1px solid var(--border-color);
        }
        h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--border-color);
        }
        .input-group {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            align-items: center;
        }
        input[type="text"] {
            width: 100%;
            min-width: 200px;
            max-width: 300px;
            padding: var(--spacing-sm);
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box;
            color: var(--text-color);
            font-family: 'Roboto Condensed', sans-serif;
            text-align: left;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        .btn {
            display: inline-block;
            padding: var(--spacing-md) var(--spacing-lg);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-variant-color));
            color: #FFFFFF;
            text-decoration: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            border: none;
            text-align: center;
            transition: transform 0.2s;
        }
        html[data-theme="dark"] .btn {
            color: var(--bg-color);
        }
        .btn:hover {
            transform: scale(1.05);
        }
        .table-wrapper {
            overflow-x: auto;
            overflow-y: auto;
            max-height: 70vh;
            max-width: 100%;
            -webkit-overflow-scrolling: touch;
        }
        table {
            width: 100%;
            min-width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: var(--spacing-md) 4px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-color);
        }
        th {
            font-family: 'Poppins', sans-serif;
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--primary-variant-color);
            font-weight: 700;
        }
        html[data-theme="light"] th {
            background-color: #F9FAFB;
        }
        td.matchup {
            white-space: normal;
            min-width: 250px;
        }
        td.score-diff.positive, td.mmr-change.positive {
            color: #4CAF50;
            font-weight: bold;
        }
        td.score-diff.negative, td.mmr-change.negative {
            color: #F44336;
            font-weight: bold;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }
        .stat-box {
            background: rgba(0,0,0,0.1);
            padding: var(--spacing-md);
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.2s;
        }
        html[data-theme="light"] .stat-box {
            background: rgba(0,0,0,0.02);
        }
        .stat-box:hover {
            transform: translateY(-5px);
        }
        .stat-box h3 {
            font-size: 1.2rem;
            margin: 0 0 var(--spacing-sm);
            color: var(--primary-color);
        }
        .stat-box p {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--accent-gold);
        }
        .toast {
            position: fixed;
            bottom: var(--spacing-lg);
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #333, #111);
            color: #fff;
            padding: var(--spacing-md) 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px var(--shadow-color);
            opacity: 0;
            transition: opacity 0.4s, transform 0.4s;
            font-weight: 700;
            font-family: 'Roboto Condensed', sans-serif;
            z-index: 1000;
        }
        .toast.show {
            opacity: 1;
        }
        .theme-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: transform 0.2s;
        }
        .theme-toggle:hover {
            transform: rotate(360deg);
        }
        @media screen and (max-width: 600px) {
            th, td {
                padding: 4px 2px;
                font-size: 0.7rem;
                color: var(--text-color);
            }
            td.matchup {
                min-width: 100px;
                max-width: 200px;
                font-size: 0.7rem;
                letter-spacing: -0.5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            input[type="text"] {
                min-width: 150px;
                max-width: 100%;
                font-size: 0.9rem;
            }
            .btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            h1 {
                font-size: 2rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--spacing-sm);
            }
            .stat-box {
                padding: 8px;
            }
            .stat-box h3 {
                font-size: 0.9rem;
            }
            .stat-box p {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" id="theme-toggle">‚òÄÔ∏è</button>
    <div class="container">
        <h1>ÌååÌä∏ÎÑà Ï†ÑÏ†Å</h1>
        <div class="section">
            <h2>ÌååÌä∏ÎÑà ÏÑ†ÌÉù</h2>
            <div class="input-group">
                <input type="text" id="player1" list="player-list" placeholder="ÏÑ†Ïàò 1">
                <input type="text" id="player2" list="player-list" placeholder="ÏÑ†Ïàò 2">
                <datalist id="player-list"></datalist>
                <button id="search-btn" class="btn">Ï†ÑÏ†Å Í≤ÄÏÉâ</button>
                <button id="back-btn" class="btn">Î©îÏù∏ÏúºÎ°ú</button>
            </div>
            <div class="stats-grid" id="stats-grid"></div>
            <div class="table-wrapper">
                <table id="partner-table">
                    <thead>
                        <tr>
                            <th>ÌöåÏ∞®</th>
                            <th>Í≤∞Í≥º</th>
                            <th>ÏÉÅÎåÄÌåÄ</th>
                            <th>Ïä§ÏΩîÏñ¥</th>
                            <th>Ïä§ÏΩîÏñ¥Ï∞®</th>
                            <th>MMR Î≥ÄÌôî (ÏÑ†Ïàò1)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="toast" class="toast"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        // tetus-c91f0 ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyCj33GM2pM2-Vz1Fmh6eyMwQkWjByA7xdw",
            authDomain: "tetus-c91f0.firebaseapp.com",
            projectId: "tetus-c91f0",
            storageBucket: "tetus-c91f0.firebasestorage.app",
            messagingSenderId: "877913022272",
            appId: "1:877913022272:web:ec685d63235c87c3c1e4a5",
            measurementId: "G-7FJY9EKPV5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let allPlayersData = [];
        let allMatchesData = [];

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), duration);
            } else {
                console.warn("Toast ÏöîÏÜå ÏóÜÏùå!");
            }
        }

        function applyTheme(theme) {
            const validTheme = theme === 'light' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', validTheme);
            localStorage.setItem('theme', validTheme);
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.textContent = validTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }
            console.log(`ÌÖåÎßà Ï†ÅÏö©: ${validTheme}`);
        }

        function normalizeName(name) {
            return name ? name.replace(/[@.*\s*]+/g, '').toLowerCase() : '';
        }

        // index.htmlÏùò MMR Í≥ÑÏÇ∞ Î°úÏßÅ (Ìó¨Ìçº Ìï®Ïàò)
        const calculateMMRChange = (player, opponentTeamMMR, isWinner, partner, isFourPoint, scoreWeight) => {
            const constants = {
                BASE_MMR: 1500, BASE_K: 32, WIN_BONUS: 1.2, LOSS_REDUCTION: 0.9, FOUR_POINT_MMR_MULTIPLIER: 0.6
            };
            
            if (!player) return 0;
            let K = constants.BASE_K;
            let playerMMR = player.mmr || constants.BASE_MMR;
            const expectedWinRate = 1 / (1 + Math.pow(10, (opponentTeamMMR - playerMMR) / 400));
            let mmrChange = K * ((isWinner ? 1 : 0) - expectedWinRate) * scoreWeight;

            if (isFourPoint) mmrChange *= constants.FOUR_POINT_MMR_MULTIPLIER;

            const isPlayerEffectivelyFemale = player.isFemale && player.mmr < 1850;
            const isPartnerEffectivelyFemale = partner?.isFemale && partner?.mmr < 1850;
            const isPlayerTeamMixed = (isPlayerEffectivelyFemale && !isPartnerEffectivelyFemale) || (!isPlayerEffectivelyFemale && isPartnerEffectivelyFemale);
            
            if (isWinner) {
                mmrChange *= isPlayerTeamMixed ? 1.5 : constants.WIN_BONUS;
            } else {
                mmrChange *= isPlayerTeamMixed ? 0.3 : constants.LOSS_REDUCTION;
            }
            
            let finalChange = Math.round(mmrChange);
            if (isWinner && finalChange < 10) finalChange = 10;
            
            return finalChange;
        };
        
        async function loadFirebaseData() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const seasonVersion = urlParams.get('season') || 'v2'; // URLÏóêÏÑú ÏãúÏ¶å Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞

                // Îû≠ÌÇπ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                const rankingDoc = await getDoc(doc(db, 'league', 'data', 'rankings', seasonVersion));
                if (rankingDoc.exists()) {
                    allPlayersData = rankingDoc.data().players || [];
                } else {
                    showToast("ÏÑ†Ïàò Îû≠ÌÇπ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!");
                    return false;
                }

                // Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                const scheduleDoc = await getDoc(doc(db, 'league', 'data', 'schedule', seasonVersion));
                if (scheduleDoc.exists()) {
                    allMatchesData = scheduleDoc.data().matches || [];
                } else {
                    showToast("Í≤ΩÍ∏∞ Í∏∞Î°ùÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!");
                    return false;
                }
                
                // Datalist Ï±ÑÏö∞Í∏∞
                const playerList = document.getElementById('player-list');
                if (playerList) {
                     playerList.innerHTML = allPlayersData.map(player => 
                        `<option value="${player.isFemale ? `${player.name}*` : player.name}"></option>`
                    ).join('');
                }
                
                console.log("ÏÑ†Ïàò Î™©Î°ù Î°úÎìú ÏôÑÎ£å:", allPlayersData.length);
                console.log("Îß§Ïπò Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å:", allMatchesData.length);
                return true;

            } catch (e) {
                console.error("Firebase Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:", e);
                showToast("Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®!");
                return false;
            }
        }


        async function filterMatches() {
            const player1Input = document.getElementById('player1').value.trim();
            const player2Input = document.getElementById('player2').value.trim();
            if (!player1Input || !player2Input) {
                showToast("Îëê ÏÑ†ÏàòÎ•º Î™®Îëê ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!");
                return;
            }

            const player1Norm = normalizeName(player1Input);
            const player2Norm = normalizeName(player2Input);
            
            if (player1Norm === player2Norm) {
                showToast("ÎèôÏùºÌïú ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌï† Ïàò ÏóÜÏäµÎãàÎã§!");
                return;
            }

            const filteredMatches = allMatchesData.filter(match => {
                const normalizedPlayers = match.players.map(p => normalizeName(p));
                const p1Idx = normalizedPlayers.indexOf(player1Norm);
                const p2Idx = normalizedPlayers.indexOf(player2Norm);

                if (p1Idx === -1 || p2Idx === -1) return false;
                
                // Í∞ôÏùÄ ÌåÄÏù∏ÏßÄ ÌôïÏù∏
                const isP1Team1 = p1Idx < 2;
                const isP2Team1 = p2Idx < 2;
                return isP1Team1 === isP2Team1;
            });

            console.log("ÌïÑÌÑ∞ÎßÅÎêú Îß§Ïπò:", filteredMatches);

            const statsGrid = document.getElementById('stats-grid');
            const tableBody = document.querySelector('#partner-table tbody');
            if (!statsGrid || !tableBody) {
                console.error("stats-grid ÎòêÎäî partner-table tbody ÏöîÏÜå ÏóÜÏùå!");
                showToast("ÌéòÏù¥ÏßÄ ÏöîÏÜå Ïò§Î•ò!");
                return;
            }
            tableBody.innerHTML = '';
            statsGrid.innerHTML = '';

            if (filteredMatches.length === 0) {
                showToast("ÏÑ†ÌÉùÌïú ÌååÌä∏ÎÑà Í∞ÑÏùò Ï†ÑÏ†ÅÏù¥ ÏóÜÏäµÎãàÎã§!");
                return;
            }

            let wins = 0, losses = 0, totalGameDiff = 0, totalMMRChangeP1 = 0;
            
            filteredMatches.sort((a, b) => a.round - b.round);
            
            filteredMatches.forEach(match => {
                const p1NormIdx = match.players.map(p => normalizeName(p)).indexOf(player1Norm);
                const isTeam1 = p1NormIdx < 2; // Í≤ÄÏÉâÎêú ÏÑ†ÏàòÎì§Ïù¥ ÌåÄ1Ïóê ÏûàÎäîÏßÄ Ïó¨Î∂Ä

                // ÏÉÅÎåÄÌåÄ ÏÑ†Ïàò Ïù¥Î¶Ñ Ï∞æÍ∏∞
                const opponent1 = (isTeam1 ? match.players[2] : match.players[0]).replace(/\*/g, '');
                const opponent2 = (isTeam1 ? match.players[3] : match.players[1]).replace(/\*/g, '');
                let matchup = `${opponent1}+${opponent2}`;
                
                let result = '‚ùå';
                let gameDiff = 0;
                let scoreDiffDisplay = '-';
                let mmrChangeP1 = 0;

                if (match.score && /^\d+-\d+$/.test(match.score)) {
                    const [score1, score2] = match.score.split('-').map(Number);
                    
                    if (isTeam1) { // Í≤ÄÏÉâÎêú ÌåÄÏù¥ ÌåÄ1(player1, player2)Ïù∏ Í≤ΩÏö∞
                        gameDiff = score1 - score2;
                        if (score1 > score2) {
                            wins++;
                            result = '‚úÖ';
                        } else {
                            losses++;
                        }
                    } else { // Í≤ÄÏÉâÎêú ÌåÄÏù¥ ÌåÄ2(player3, player4)Ïù∏ Í≤ΩÏö∞
                        gameDiff = score2 - score1;
                        if (score2 > score1) {
                            wins++;
                            result = '‚úÖ';
                        } else {
                            losses++;
                        }
                    }
                    scoreDiffDisplay = gameDiff > 0 ? `+${gameDiff}` : `${gameDiff}`;
                    totalGameDiff += gameDiff;

                    // MMR Î≥ÄÌôî Í≥ÑÏÇ∞ (ÏÑ†Ïàò1 Í∏∞Ï§Ä)
                    const p1Data = allPlayersData.find(p => normalizeName(p.name) === player1Norm);
                    const p2Data = allPlayersData.find(p => normalizeName(p.name) === player2Norm);
                    const p3Data = allPlayersData.find(p => normalizeName(p.name) === normalizeName(match.players[2]));
                    const p4Data = allPlayersData.find(p => normalizeName(p.name) === normalizeName(match.players[3]));

                    if(p1Data && p2Data && p3Data && p4Data) {
                        const team1MMR = (p1Data.mmr + p2Data.mmr) / 2;
                        const team2MMR = (p3Data.mmr + p4Data.mmr) / 2;
                        const scoreWeight = 0.8 + (Math.abs(score1 - score2) / 6) * 0.7;

                        if (isTeam1) {
                            mmrChangeP1 = calculateMMRChange(p1Data, team2MMR, score1 > score2, p2Data, match.isFourPoint, scoreWeight);
                        } else {
                            // p1Ïù¥ ÌåÄ2(p3, p4)Ïóê ÏÜçÌïú Í≤ΩÏö∞ (Ïù¥ Î°úÏßÅÏùÄ p1NormIdx Í∏∞Ï§ÄÏù¥Îùº p1DataÎ•º ÏÇ¨Ïö©)
                            mmrChangeP1 = calculateMMRChange(p1Data, team1MMR, score2 > score1, (p1NormIdx === 2 ? p4Data : p3Data), match.isFourPoint, scoreWeight);
                        }
                        totalMMRChangeP1 += mmrChangeP1;
                    }
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${match.round}</td>
                    <td>${result}</td>
                    <td class="matchup">${matchup}</td>
                    <td>${match.score || '-'}</td>
                    <td class="score-diff ${gameDiff > 0 ? 'positive' : gameDiff < 0 ? 'negative' : ''}">${scoreDiffDisplay}</td>
                    <td class="mmr-change ${mmrChangeP1 > 0 ? 'positive' : mmrChangeP1 < 0 ? 'negative' : ''}">${mmrChangeP1 !== 0 ? (mmrChangeP1 > 0 ? `+${mmrChangeP1}` : mmrChangeP1) : '-'}</td>
                `;
                tableBody.appendChild(row);
            });

            const totalMatches = wins + losses;
            const winRate = totalMatches > 0 ? ((wins / totalMatches) * 100).toFixed(1) : '0.0';
            const avgGameDiff = totalMatches > 0 ? (totalGameDiff / totalMatches).toFixed(2) : '0.00';
            statsGrid.innerHTML = `
                <div class="stat-box"><h3>Ï¥ù Í≤ΩÍ∏∞</h3><p>${totalMatches}</p></div>
                <div class="stat-box"><h3>Ïäπ</h3><p>${wins}</p></div>
                <div class="stat-box"><h3>Ìå®</h3><p>${losses}</p></div>
                <div class="stat-box"><h3>ÏäπÎ•†(%)</h3><p>${winRate}</p></div>
                <div class="stat-box"><h3>ÌèâÍ∑† Ï†êÏàòÏ∞®</h3><p>${avgGameDiff > 0 ? '+' : ''}${avgGameDiff}</p></div>
                <div class="stat-box"><h3>Ï¥ù MMR Î≥ÄÌôî</h3><p>${totalMMRChangeP1 > 0 ? '+' : ''}${totalMMRChangeP1}</p></div>
            `;
            showToast("ÌååÌä∏ÎÑà Ï†ÑÏ†Å Í≤ÄÏÉâ ÏôÑÎ£å!");
        }

        document.addEventListener('DOMContentLoaded', async () => {
            console.log("DOMContentLoaded Ïù¥Î≤§Ìä∏ ÏãúÏûë");
            
            const savedTheme = localStorage.getItem('theme') || 'dark';
            applyTheme(savedTheme);
            
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    applyTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
                });
            }

            try {
                await signInAnonymously(auth);
                console.log("Signed in anonymously.");
                const dataLoaded = await loadFirebaseData();
                if (dataLoaded) {
                    const searchBtn = document.getElementById('search-btn');
                    const backBtn = document.getElementById('back-btn');
                    if (searchBtn) {
                        searchBtn.addEventListener('click', filterMatches);
                    }
                    if (backBtn) {
                        backBtn.addEventListener('click', () => {
                            window.location.href = 'index.html';
                        });
                    }
                    
                    document.querySelectorAll('#player1, #player2').forEach(input => {
                        input.addEventListener('keypress', e => {
                            if (e.key === 'Enter') filterMatches();
                        });
                    });
                    console.log("Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ÏôÑÎ£å!");
                }
            } catch (error) {
                console.error("Anonymous sign-in failed:", error);
                showToast("DB Ïù∏Ï¶ùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
            }
        });
    </script>
</body>
</html>